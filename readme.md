# Iperf on FreeRTOS+ TCP for STM32H753 Nucleo

This is a port of [Hein Tibosch's iperf](https://github.com/htibosch/freertos_plus_projects/tree/e2f7fca43a6c52013027a42a7d1df1a5bbe84eba) to run on an STM32H753 Nucleo.

Specifically, it is tested to work on STM32CubeIDE v1.16.1, using STM32Cube FW_H7 v1.11.2.

Note that automatic code generation from the ioc _will break things_, because some things are defined in places that the ioc code generator does not default to, and so the autogenerated versions have to be commented out.

It is recommended to run a diff every time you use the code generator to make sure the things that should be commented out are commented out.

SYSCLK runs at 400MHz, peripheral clocks that can take 200MHz run at that, and everything else runs at 100MHz. This is important for the timestamps to work.

To see the UDP debug messages, run:

`netcat -l 2403 -u -k`

## Important caveats

1. Use iperf v3.1.x (tested with v3.1.3). Later versions don't have the right command string, and thus if you use -R (Nucleo -> PC) in your iperf command **it will not work**. PC -> Nucleo works regardless (tested up to iperf v3.13.x).
2. Make sure that your PC firewall does not interfere.
